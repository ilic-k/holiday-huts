<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <h2>Moje Vikendice</h2>
      <hr>
    </div>
  </div>

  <div class="row">
    <!-- Lista vikendica (levo) -->
    <div [class]="isFormVisible ? 'col-md-7' : 'col-12'">
      <div class="mb-3">
        <button class="btn btn-success" (click)="showAddForm()">
          ‚ûï Dodaj Novu Vikendicu
        </button>
      </div>

      @if (cottageList.length === 0) {
        <div class="alert alert-info">
          Jo≈° nemate vikendica. Kliknite "Dodaj Novu Vikendicu" da dodate prvu.
        </div>
      } @else {
        <div class="table-responsive">
          <table class="table table-bordered table-hover">
            <thead class="table-light">
              <tr>
                <th>Naziv</th>
                <th>Mesto</th>
                <th>Cena Leto</th>
                <th>Cena Zima</th>
                <th>Akcije</th>
              </tr>
            </thead>
            <tbody>
              @for (cottage of cottageList; track cottage._id) {
                <tr>
                  <td>{{ cottage.title }}</td>
                  <td>{{ cottage.place }}</td>
                  <td>{{ cottage.pricing?.summer || 0 }} EUR</td>
                  <td>{{ cottage.pricing?.winter || 0 }} EUR</td>
                  <td>
                    <button class="btn btn-sm btn-primary me-1" (click)="showEditForm(cottage)">
                      ‚úèÔ∏è Izmeni
                    </button>
                    <button class="btn btn-sm btn-danger" (click)="deleteCottage(cottage._id)">
                      üóëÔ∏è Obri≈°i
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </div>

    <!-- Form panel (desno) -->
    @if (isFormVisible) {
      <div class="col-md-5">
        <div class="card">
          <div class="card-header">
            <strong>{{ isEditMode ? 'Izmeni Vikendicu' : 'Dodaj Novu Vikendicu' }}</strong>
          </div>
          <div class="card-body">
            <form (ngSubmit)="saveCottage()">
              <div class="mb-3">
                <label class="form-label">Naziv *</label>
                <input type="text" class="form-control" [(ngModel)]="title" name="title" required>
              </div>

              <div class="mb-3">
                <label class="form-label">Mesto *</label>
                <input type="text" class="form-control" [(ngModel)]="place" name="place" required>
              </div>

              <div class="mb-3">
                <label class="form-label">Usluge / Sadr≈æaji</label>
                <textarea class="form-control" [(ngModel)]="services" name="services" rows="2" 
                  placeholder="Wi-Fi, Parking, Ro≈°tilj, Bazen..."></textarea>
              </div>

              <div class="mb-3">
                <label class="form-label">Telefon</label>
                <input type="tel" class="form-control" [(ngModel)]="phone" name="phone" 
                  placeholder="+381 64 123 4567">
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Geografska ≈°irina (Latitude)</label>
                  <input type="number" step="0.000001" class="form-control" [(ngModel)]="latitude" name="latitude" 
                    placeholder="44.787197">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Geografska du≈æina (Longitude)</label>
                  <input type="number" step="0.000001" class="form-control" [(ngModel)]="longitude" name="longitude" 
                    placeholder="20.457273">
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Cena Leto (EUR)</label>
                  <input type="number" class="form-control" [(ngModel)]="summerPrice" name="summerPrice" min="0">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Cena Zima (EUR)</label>
                  <input type="number" class="form-control" [(ngModel)]="winterPrice" name="winterPrice" min="0">
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">Slike vikendice</label>
                <input type="file" class="form-control" (change)="onFileChange($event)" 
                  accept="image/jpeg,image/jpg,image/png" multiple>
                <small class="text-muted">Mo≈æete izabrati vi≈°e slika odjednom (JPG, PNG)</small>
                @if (imageFiles.length > 0) {
                  <div class="mt-2">
                    <strong>Izabrano slika: {{imageFiles.length}}</strong>
                  </div>
                }
                @if (isEditMode && existingImages.length > 0) {
                  <div class="mt-2">
                    <small class="text-info">Postojeƒáe slike: {{existingImages.length}}</small>
                  </div>
                }
              </div>

              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-success">
                  ‚úÖ Saƒçuvaj
                </button>
                <button type="button" class="btn btn-secondary" (click)="cancelForm()">
                  ‚ùå Otka≈æi
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    }
  </div>
</div>
